<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP - Trang chủ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="MCP Logo">
            <h1>MCP Platform</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#" class="active">Trang chủ</a></li>
                <li><a href="#">Dịch vụ</a></li>
                <li><a href="#">Giới thiệu</a></li>
                <li><a href="#">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Nền tảng trí tuệ nhân tạo cho doanh nghiệp</h1>
            <p>Tối ưu hóa quy trình làm việc và tăng hiệu suất với các giải pháp AI tiên tiến</p>
            <button class="cta-button">Dùng thử miễn phí</button>
        </div>
        <div class="hero-image">
            <img src="{{ url_for('static', filename='images/hero-image.png') }}" alt="AI Platform">
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <h2>Tính năng nổi bật</h2>
        <div class="feature-cards">
            <div class="feature-card">
                <i class="fas fa-search"></i>
                <h3>Tìm kiếm thông minh</h3>
                <p>Tìm kiếm thông tin nhanh chóng và chính xác từ nhiều nguồn dữ liệu</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-cloud-sun-rain"></i>
                <h3>Dự báo thời tiết</h3>
                <p>Cung cấp thông tin thời tiết chính xác cho nhiều khu vực</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-chart-line"></i>
                <h3>Phân tích dữ liệu</h3>
                <p>Phân tích và dự báo xu hướng từ dữ liệu của bạn</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="MCP Logo">
                <h3>MCP Platform</h3>
            </div>
            <div class="footer-links">
                <h4>Liên kết</h4>
                <ul>
                    <li><a href="#">Trang chủ</a></li>
                    <li><a href="#">Dịch vụ</a></li>
                    <li><a href="#">Giới thiệu</a></li>
                    <li><a href="#">Liên hệ</a></li>
                </ul>
            </div>
            <div class="footer-contact">
                <h4>Liên hệ</h4>
                <p><i class="fas fa-envelope"></i> info@mcpplatform.com</p>
                <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                <p><i class="fas fa-map-marker-alt"></i> Hà Nội, Việt Nam</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 MCP Platform. Tất cả các quyền được bảo lưu.</p>
        </div>
    </footer>

    <!-- Chatbot Button -->
    <div class="chat-button" id="chat-button">
        <i class="fas fa-comment-dots"></i>
    </div>

    <!-- Chat Interface -->
    <div class="chat-widget" id="chat-widget">
        <div class="chat-header">
            <h3>MCP Assistant</h3>
            <div class="chat-controls">
                <button id="toggle-suggestions" class="toggle-suggestions-btn"><i class="fas fa-lightbulb"></i></button>
                <button id="minimize-chat"><i class="fas fa-minus"></i></button>
                <button id="close-chat"><i class="fas fa-times"></i></button>
            </div>
        </div>
        
        <div id="chat-history" class="chat-history">
            <div class="welcome-message">
                <div class="ai-response">
                    <div class="avatar ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <strong>AI:</strong> Xin chào! Tôi là trợ lý AI. Tôi có thể giúp bạn tìm kiếm thông tin, dự báo thời tiết, phân tích dữ liệu và nhiều việc khác. Hãy đặt câu hỏi hoặc chọn một gợi ý để bắt đầu.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="suggestion-container" id="suggestion-panel">
            <h3>Gợi ý câu lệnh:</h3>
            <div class="suggestions">
                <button class="suggestion-btn" onclick="insertSuggestion('Tìm thông tin của Trần Tuấn Anh')">Tìm thông tin của Trần Tuấn Anh</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Thời tiết ở Hà Nội')">Thời tiết ở Hà Nội</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Cảnh báo thời tiết ở CA')">Cảnh báo thời tiết ở CA</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Dự báo thời tiết tại vĩ độ 21.0278 và kinh độ 105.8342')">Dự báo thời tiết Hà Nội</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Tìm thông tin của học sinh trong file excel thongtincanhan.xlsx')">Tìm thông tin trong Excel</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Dự báo từ dữ liệu trong file Test_data_AI.csv từ repository DLL_Label của user tuananhs702')">Dự báo từ GitHub</button>
            </div>
        </div>
        
        <div class="chat-input-container">
            <form action="/query" method="post" id="query-form" target="chat-response-frame">
                <div class="input-group">
                    <textarea id="query" name="query" placeholder="Nhập câu hỏi của bạn..." rows="1" required></textarea>
                    <input type="hidden" name="continue_chat" value="true">
                    <button type="submit" class="send-btn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </form>
        </div>
        
        <!-- Hidden iframe to handle form submission without page reload -->
        <iframe name="chat-response-frame" id="chat-response-frame" style="display:none;"></iframe>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Chat widget toggle
            const chatButton = document.getElementById('chat-button');
            const chatWidget = document.getElementById('chat-widget');
            const minimizeChat = document.getElementById('minimize-chat');
            const closeChat = document.getElementById('close-chat');
            
            chatButton.addEventListener('click', function() {
                chatWidget.classList.add('active');
                chatButton.style.display = 'none';
            });
            
            minimizeChat.addEventListener('click', function() {
                chatWidget.classList.remove('active');
                chatButton.style.display = 'flex';
            });
            
            closeChat.addEventListener('click', function() {
                chatWidget.classList.remove('active');
                chatButton.style.display = 'flex';
            });
            
            // Suggestion panel
            const suggestionPanel = document.getElementById('suggestion-panel');
            suggestionPanel.classList.add('active'); // Show suggestions by default in widget
            
            // Textarea auto-resize
            const textarea = document.getElementById('query');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                if (this.scrollHeight > 100) {
                    this.style.height = '100px';
                    this.style.overflowY = 'auto';
                }
            });
            
            // Handle form submission
            document.getElementById('query-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const query = textarea.value.trim();
                if (!query) return;
                
                // Add user message to chat
                const chatHistory = document.getElementById('chat-history');
                const userMessage = document.createElement('div');
                userMessage.className = 'chat-entry';
                userMessage.innerHTML = `
                    <div class="user-query">
                        <div class="avatar user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-content">
                            <strong>Bạn:</strong> ${query}
                        </div>
                    </div>
                `;
                chatHistory.appendChild(userMessage);
                
                // Add loading indicator
                const loadingElement = document.createElement('div');
                loadingElement.className = 'chat-entry loading-message';
                loadingElement.innerHTML = `
                    <div class="ai-response">
                        <div class="avatar ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                chatHistory.appendChild(loadingElement);
                chatHistory.scrollTop = chatHistory.scrollHeight;
                
                // Send request to server using the API endpoint
                fetch('/api/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        'query': query,
                        'save_history': true
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove loading indicator
                    chatHistory.removeChild(loadingElement);
                    
                    // Create AI response element
                    const aiResponse = document.createElement('div');
                    aiResponse.className = 'chat-entry';
                    aiResponse.innerHTML = `
                        <div class="ai-response">
                            <div class="avatar ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <strong>AI:</strong> ${data.response}
                            </div>
                        </div>
                    `;
                    chatHistory.appendChild(aiResponse);
                    
                    // Scroll to bottom
                    chatHistory.scrollTop = chatHistory.scrollHeight;
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Remove loading indicator
                    chatHistory.removeChild(loadingElement);
                    
                    // Add error message
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'chat-entry';
                    errorMessage.innerHTML = `
                        <div class="ai-response">
                            <div class="avatar ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <strong>AI:</strong> Đã xảy ra lỗi khi xử lý yêu cầu của bạn. Vui lòng thử lại sau.
                            </div>
                        </div>
                    `;
                    chatHistory.appendChild(errorMessage);
                    chatHistory.scrollTop = chatHistory.scrollHeight;
                });
            });
        });
        
        // Function to insert suggestion into textarea
        function insertSuggestion(text) {
            const textarea = document.getElementById('query');
            textarea.value = text;
            textarea.focus();
            
            // Trigger input event to resize textarea
            const event = new Event('input', { bubbles: true });
            textarea.dispatchEvent(event);
        }
    </script>
</body>
</html>