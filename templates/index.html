<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Web Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MCP Web Interface</h1>
            <button id="toggle-suggestions" class="toggle-btn">
                <i class="fas fa-lightbulb"></i> Gợi ý
            </button>
        </div>
        
        <div class="suggestion-container" id="suggestion-panel">
            <h3>Gợi ý câu lệnh:</h3>
            <div class="suggestions">
                <button class="suggestion-btn" onclick="insertSuggestion('Tìm thông tin của Trần Tuấn Anh')">Tìm thông tin của Trần Tuấn Anh</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Thời tiết ở Hà Nội')">Thời tiết ở Hà Nội</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Cảnh báo thời tiết ở CA')">Cảnh báo thời tiết ở CA</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Dự báo thời tiết tại vĩ độ 21.0278 và kinh độ 105.8342')">Dự báo thời tiết Hà Nội</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Tìm thông tin của học sinh trong file excel thongtincanhan.xlsx')">Tìm thông tin trong Excel</button>
                <button class="suggestion-btn" onclick="insertSuggestion('Dự báo từ dữ liệu trong file Test_data_AI.csv từ repository DLL_Label của user tuananhs702')">Dự báo từ GitHub</button>
            </div>
        </div>
        
        <!-- Khu vực hiển thị lịch sử chat -->
        <div id="chat-history" class="chat-history">
            {% if chat_history %}
                {% for entry in chat_history %}
                    <div class="chat-entry">
                        <div class="user-query">
                            <div class="avatar user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <strong>Bạn:</strong> {{ entry.query }}
                            </div>
                        </div>
                        <div class="ai-response">
                            <div class="avatar ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <strong>AI:</strong> {{ entry.response|safe }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="welcome-message">
                    <div class="ai-response">
                        <div class="avatar ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <strong>AI:</strong> Xin chào! Tôi là trợ lý AI. Tôi có thể giúp bạn tìm kiếm thông tin, dự báo thời tiết, phân tích dữ liệu và nhiều việc khác. Hãy đặt câu hỏi hoặc chọn một gợi ý để bắt đầu.
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div class="input-container">
            <form action="/query" method="post" id="query-form">
                <div class="form-group">
                    <label for="query">Nhập câu hỏi của bạn:</label>
                    <textarea id="query" name="query" rows="2" required></textarea>
                </div>
                <input type="hidden" name="continue_chat" value="true">
                <button type="submit" class="send-btn"><i class="fas fa-paper-plane"></i> Gửi</button>
            </form>
            
            <form action="/clear_history" method="post" class="clear-form">
                <button type="submit" class="clear-btn"><i class="fas fa-trash"></i> Xóa lịch sử</button>
            </form>
        </div>
    </div>

    <script>
        // Cuộn xuống cuối lịch sử chat khi tải trang
        document.addEventListener('DOMContentLoaded', function() {
            var chatHistory = document.getElementById('chat-history');
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            // Ensure suggestion panel is closed by default
            const suggestionPanel = document.getElementById('suggestion-panel');
            suggestionPanel.classList.remove('active');
            
            // Tự động điều chỉnh chiều cao của textarea
            const textarea = document.getElementById('query');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                // Giới hạn chiều cao tối đa
                if (this.scrollHeight > 150) {
                    this.style.height = '150px';
                    this.style.overflowY = 'auto';
                }
            });
            
            // Thêm hiệu ứng loading khi gửi form
            document.getElementById('query-form').addEventListener('submit', function() {
                // Tạo phần tử loading
                const loadingElement = document.createElement('div');
                loadingElement.className = 'chat-entry';
                loadingElement.innerHTML = `
                    <div class="ai-response">
                        <div class="avatar ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Thêm vào chat history
                chatHistory.appendChild(loadingElement);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            });
            
            // Hiển thị/ẩn panel gợi ý
            document.getElementById('toggle-suggestions').addEventListener('click', function() {
                const suggestionPanel = document.getElementById('suggestion-panel');
                suggestionPanel.classList.toggle('active');
                this.classList.toggle('active');
            });
        });
        
        // Hàm chèn gợi ý vào ô nhập liệu
        function insertSuggestion(text) {
            const textarea = document.getElementById('query');
            textarea.value = text;
            // Tự động focus vào textarea
            textarea.focus();
            // Kích hoạt sự kiện input để điều chỉnh chiều cao
            const event = new Event('input', { bubbles: true });
            textarea.dispatchEvent(event);
        }
    </script>
</body>
</html>